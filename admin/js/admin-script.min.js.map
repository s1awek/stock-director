{"version":3,"file":"admin-script.min.js","names":["createApp","ref","computed","watch","nextTick","Vue","app","setup","conditions","initialConditions","newCondition","minQuantity","maxQuantity","message","currentConditions","length","lastCondition","value","immediate","console","log","mwsData","isValidNewCondition","isRangeValid","parseInt","isMessageFilled","trim","isUniqueRange","every","condition","addCondition","push","sort","a","b","forEach","idx","document","getElementById","focus","removeCondition","index","splice","saveConditions","async","response","fetch","ajax_url","method","credentials","headers","body","URLSearchParams","action","nonce","JSON","stringify","ok","Error","responseData","json","success","error","mount"],"sources":["admin-script.js"],"mappings":"AAAA,MAAMA,UAAEA,UAASC,IAAEA,IAAGC,SAAEA,SAAQC,MAAEA,MAAKC,SAAEA,UAAaC,IAEhDC,IAAMN,UAAU,CACpB,KAAAO,GAEE,MAAMC,EAAaP,IAAIQ,mBAAqB,IACtCC,EAAeT,IAAI,CACvBU,YAAa,EACbC,YAAa,KACbC,QAAS,KAGXV,MAAMK,GAAaM,IACjB,GAAIA,EAAkBC,OAAS,EAAG,CAChC,MAAMC,EAAgBF,EAAkBA,EAAkBC,OAAS,GACnEL,EAAaO,MAAMN,YAAcK,EAAcJ,WACjD,MACEF,EAAaO,MAAMN,YAAc,CACnC,GACC,CAAEO,WAAW,IAChBC,QAAQC,IAAIC,SAEZ,MAAMC,EAAsBpB,UAAS,KACnC,MAAMS,YAAEA,EAAWC,YAAEA,EAAWC,QAAEA,GAAYH,EAAaO,MACrDM,EAA+B,OAAhBZ,GAAwC,OAAhBC,GAAwBY,SAASb,GAAea,SAASZ,GAChGa,EAAkBZ,EAAQa,OAAOX,OAAS,EAC1CY,EAA4C,IAA5BnB,EAAWS,MAAMF,QAAgBP,EAAWS,MAAMW,OAAMC,GAC5EjB,EAAciB,EAAUjB,cAE1B,OAAOW,GAAgBE,GAAmBE,CAAa,IAgFzD,MAAO,CACLnB,aACAE,eACAoB,aA/EmB,KACfR,EAAoBL,QAEtBT,EAAWS,MAAMc,KAAK,IAAKrB,EAAaO,QACxCT,EAAWS,MAAMe,MAAK,CAACC,EAAGC,IAAMD,EAAEtB,YAAcuB,EAAEvB,cAGlDH,EAAWS,MAAMkB,SAAQ,CAACN,EAAWO,KAC/BA,EAAM,IACR5B,EAAWS,MAAMmB,GAAKzB,YAAcH,EAAWS,MAAMmB,EAAM,GAAGxB,YAChE,IAIFF,EAAaO,MAAQ,CAAEN,YAAaH,EAAWS,MAAMT,EAAWS,MAAMF,OAAS,GAAGH,YAAaA,YAAa,KAAMC,QAAS,IAG3HT,UAAS,KACPiC,SAASC,eAAe,eAAeC,OAAO,IAElD,EA4DAC,gBAxDuBC,IAEvBjC,EAAWS,MAAMyB,OAAOD,EAAO,GAGC,IAA5BjC,EAAWS,MAAMF,OACnBL,EAAaO,MAAMN,YAAc,EAG7B8B,EAAQjC,EAAWS,MAAMF,SAE3BP,EAAWS,MAAMwB,GAAO9B,YAAcH,EAAWS,MAAMwB,EAAQ,GAAG7B,YAEtE,EA4CA+B,eAxCqBC,UAErB,IACE,MAAMC,QAAiBC,MAAMzB,QAAQ0B,SAAU,CAC7CC,OAAQ,OACRC,YAAa,cACbC,QAAS,CACP,eAAgB,qCAElBC,KAAM,IAAIC,gBAAgB,CACxBC,OAAQ,kBACRC,MAAOjC,QAAQiC,MACf9C,WAAY+C,KAAKC,UAAUhD,EAAWS,WAI1C,IAAK4B,EAASY,GACZ,MAAM,IAAIC,MAAM,gCAGlB,MAAMC,QAAqBd,EAASe,OAEhCD,EAAaE,QAEf1C,QAAQC,IAAI,kBAAmBuC,GAG/BxC,QAAQ2C,MAAM,iBAAkBH,EAEpC,CAAE,MAAOG,GAEP3C,QAAQ2C,MAAM,eAAgBA,EAChC,GASAxC,sBAEJ,IAGFhB,IAAIyD,MAAM","ignoreList":[],"sourcesContent":["const { createApp, ref, computed, watch, nextTick } = Vue;\n\nconst app = createApp({\n  setup() {\n    // Reactive references for conditions and a new condition form\n    const conditions = ref(initialConditions || []);\n    const newCondition = ref({\n      minQuantity: 1,\n      maxQuantity: null,\n      message: ''\n    });\n\n    watch(conditions, (currentConditions) => {\n      if (currentConditions.length > 0) {\n        const lastCondition = currentConditions[currentConditions.length - 1];\n        newCondition.value.minQuantity = lastCondition.maxQuantity;\n      } else {\n        newCondition.value.minQuantity = 1; // Resetujemy do 1 jeśli nie ma żadnych warunków\n      }\n    }, { immediate: true });\n    console.log(mwsData);\n    // Computed property to validate new condition\n    const isValidNewCondition = computed(() => {\n      const { minQuantity, maxQuantity, message } = newCondition.value;\n      const isRangeValid = minQuantity !== null && maxQuantity !== null && parseInt(minQuantity) < parseInt(maxQuantity);\n      const isMessageFilled = message.trim().length > 0;\n      const isUniqueRange = conditions.value.length === 0 || conditions.value.every(condition =>\n        maxQuantity > condition.maxQuantity\n      );\n      return isRangeValid && isMessageFilled && isUniqueRange;\n    });\n\n    // Method to add a new condition to the list\n    const addCondition = () => {\n      if (isValidNewCondition.value) {\n        // Sort conditions before adding a new one\n        conditions.value.push({ ...newCondition.value });\n        conditions.value.sort((a, b) => a.minQuantity - b.minQuantity);\n\n        // Update 'minQuantity' values of each condition to ensure they are in logical order\n        conditions.value.forEach((condition, idx) => {\n          if (idx > 0) {\n            conditions.value[idx].minQuantity = conditions.value[idx - 1].maxQuantity;\n          }\n        });\n\n        // Reset the new condition\n        newCondition.value = { minQuantity: conditions.value[conditions.value.length - 1].maxQuantity, maxQuantity: null, message: '' };\n\n        // Focus on the 'maxQuantity' field\n        nextTick(() => {\n          document.getElementById('maxQuantity').focus();\n        });\n      }\n    };\n\n    // Method to remove a condition from the list\n    const removeCondition = (index) => {\n      // Remove the selected condition\n      conditions.value.splice(index, 1);\n\n      // If there are no conditions left, reset the minQuantity for new condition to 1\n      if (conditions.value.length === 0) {\n        newCondition.value.minQuantity = 1;\n      } else {\n        // If the removed condition was not the last one, update the next condition's minQuantity\n        if (index < conditions.value.length) {\n          // Update the minQuantity of the next condition to the maxQuantity of the previous one\n          conditions.value[index].minQuantity = conditions.value[index - 1].maxQuantity;\n        }\n      }\n    };\n\n\n    const saveConditions = async () => {\n      // Wysyłanie danych do WordPressa przez AJAX\n      try {\n        const response = await fetch(mwsData.ajax_url, {\n          method: 'POST',\n          credentials: 'same-origin',\n          headers: {\n            'Content-Type': 'application/x-www-form-urlencoded',\n          },\n          body: new URLSearchParams({\n            action: 'save_conditions',\n            nonce: mwsData.nonce,\n            conditions: JSON.stringify(conditions.value),\n          }),\n        });\n\n        if (!response.ok) {\n          throw new Error('Network response was not ok.');\n        }\n\n        const responseData = await response.json();\n\n        if (responseData.success) {\n          // Obsługa sukcesu\n          console.log('Settings saved:', responseData);\n        } else {\n          // Obsługa błędów związanych z WordPress\n          console.error('Error from WP:', responseData);\n        }\n      } catch (error) {\n        // Obsługa błędów związanych z siecią\n        console.error('Fetch error:', error);\n      }\n    }\n    // Expose the state and methods to the template\n    return {\n      conditions,\n      newCondition,\n      addCondition,\n      removeCondition,\n      saveConditions,\n      isValidNewCondition\n    };\n  }\n});\n\napp.mount('#wp-stock-director-settings');\n"]}